import { useState } from 'react';
import { Button, View, Text } from 'react-native';

const App = () => {
  const [data, setData] = useState({value: {timeSeries: []}});
  const [isLoading, setIsLoading] = useState(false);
  const [err, setErr] = useState('');

  const handleClick = async () => {
    setIsLoading(true);

    try {
      const response = await fetch('https://waterservices.usgs.gov/nwis/iv?format=json&stateCd=nj', {
        method: 'GET',
        headers: {
          Accept: 'application/json',
        },
      });

      if (!response.ok) {
        throw new Error('Error! status: ${response.status}');
      }

      const result = await response.json();

      console.log('result is: ', JSON.stringify(result, null, 4));

      setData(result);
    } catch (err) {
      setErr(err.message);
    } finally {
      setIsLoading(false);
    }
  };

  console.log(data);

  return (
    <View>
      {err && <Text>{err}</Text>}

      <Button
        title="Fetch Data"
        onPress={handleClick}
      />

      {isLoading && <Text>Loading...</Text>}

      {data.value.timeSeries.map(site => {
            return (
              <View key={site.name}>
              <Text>name: {site.name}</Text>
              <Text>siteName: {site.sourceInfo.siteName}</Text>
              <Text>latitute: {site.sourceInfo.geoLocation.geogLocation.latitude}</Text>
              <Text>longitude: {site.sourceInfo.geoLocation.geogLocation.longitude}</Text>
              <Text>siteValue: {site.sourceInfo.siteCode[0].value}</Text>
              <Text>agencyCode:{site.sourceInfo.siteCode[0].agencyCode}</Text>
              <Text>{"\n"}</Text>
              </View>
            );
      })}
    </View>
  )
};

export default App;